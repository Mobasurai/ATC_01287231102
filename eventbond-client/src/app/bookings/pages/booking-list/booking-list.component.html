<div class="container mx-auto px-4 py-8">
  <h1 class="text-4xl font-bold text-center mb-12 text-gray-800">My Bookings</h1>

  <div *ngIf="feedbackMessage" 
       [ngClass]="{
         'bg-green-100 border-green-400 text-green-700': feedbackType === 'success',
         'bg-red-100 border-red-400 text-red-700': feedbackType === 'error'
       }" 
       class="border px-4 py-3 rounded relative mb-6 shadow" role="alert">
    <span class="block sm:inline">{{ feedbackMessage }}</span>
  </div>

  <div *ngIf="(bookings$ | async) as bookings; else loadingBookings">
    <div *ngIf="bookings && bookings.length > 0; else noBookings" class="space-y-6">
      <div *ngFor="let booking of bookings" class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300 ease-in-out">
        <div class="md:flex" *ngIf="booking.event"> 
          <div class="md:w-1/3">
            <a [routerLink]="['/events', booking.event.id]">
              <img class="w-full h-48 md:h-full object-cover" 
                   [src]="getEventImageUrl(booking.event)" 
                   [alt]="booking.event.title || 'Event image'">
            </a>
          </div>
          <div class="md:w-2/3 p-6">
            <h2 class="text-2xl font-semibold text-indigo-700 mb-2">
              <a [routerLink]="['/events', booking.event.id]" class="hover:underline">{{ booking.event.title }}</a> 
            </h2>
            <p class="text-gray-600 mb-1"><span class="font-medium">Category:</span> {{ booking.event.category.name || 'N/A' }}</p> <!-- Removed ?. from category.name -->
            <p class="text-gray-600 mb-1"><span class="font-medium">Date:</span> {{ booking.event.startDate | date:'fullDate' }} at {{ booking.event.startDate | date:'shortTime' }}</p> 
            <p class="text-gray-600 mb-3"><span class="font-medium">Location:</span> {{ booking.event.venue }}</p> 
            
            <div class="bg-gray-50 p-4 rounded-md mb-4">
              <p class="text-sm text-gray-700"><span class="font-medium">Booked on:</span> {{ booking.bookingDate | date:'medium' }}</p>
              <p *ngIf="booking.numberOfTickets" class="text-sm text-gray-700"><span class="font-medium">Tickets:</span> {{ booking.numberOfTickets }}</p>
              <p class="text-sm font-semibold" 
                 [ngClass]="{'text-green-600': booking.status === 'confirmed', 'text-yellow-600': booking.status === 'pending', 'text-red-600': booking.status === 'cancelled'}">
                <span class="font-medium">Status:</span> {{ booking.status | titlecase }}
              </p>
            </div>

            <button (click)="cancelBooking(booking.id)" 
                    class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transform hover:scale-105">
              Cancel Booking
            </button>
          </div>
        </div>
      </div>
    </div>

    <ng-template #noBookings>
      <div class="text-center py-16 bg-white rounded-lg shadow-md">
        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-20 w-20 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <p class="mt-6 text-2xl font-semibold text-gray-700">You have no bookings yet.</p>
        <p class="mt-2 text-gray-500">Why not explore some <a routerLink="/events" class="text-indigo-600 hover:underline font-medium">exciting events</a>?</p>
      </div>
    </ng-template>
  </div>

  <ng-template #loadingBookings>
    <div class="flex justify-center items-center py-16">
      <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-indigo-500"></div>
      <p class="ml-4 text-xl text-gray-600">Loading your bookings...</p>
    </div>
  </ng-template>
</div>
